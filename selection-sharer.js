!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):"object"==typeof exports?exports["selection-sharer"]=t():e["selection-sharer"]=t()}(this,function(){return function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var o={};return t.m=e,t.c=o,t.p="/",t(0)}([/*!*********************************!*\
  !*** ./src/selection-sharer.js ***!
  \*********************************/
function(e,t,o){function n(e){return e&&e.__esModule?e:{"default":e}}var r,i=o(/*! ./selection-sharer.css */6),a=n(i),s=o(/*! raw!./popover.html */3),l=n(s),c=o(/*! raw!./popunder.html */4),p=n(c);!function(n){var i=function(e){a["default"].use();var t=this;e=e||{},"string"==typeof e&&(e={elements:e}),this.sel=null,this.textSelection="",this.htmlSelection="",this.appId=n('meta[property="fb:app_id"]').attr("content")||n('meta[property="fb:app_id"]').attr("value"),this.url2share=n('meta[property="og:url"]').attr("content")||n('meta[property="og:url"]').attr("value")||window.location.href,this.getSelectionText=function(e){var o="",n="",e=e||window.getSelection();if(e.rangeCount){for(var r=document.createElement("div"),i=0,a=e.rangeCount;a>i;++i)r.appendChild(e.getRangeAt(i).cloneContents());n=r.textContent,o=r.innerHTML}return t.textSelection=n,t.htmlSelection=o||n,n},this.selectionDirection=function(e){var t=e||window.getSelection(),o=document.createRange();if(!t.anchorNode)return 0;o.setStart(t.anchorNode,t.anchorOffset),o.setEnd(t.focusNode,t.focusOffset);var n=o.collapsed?"backward":"forward";return o.detach(),n},this.showPopunder=function(){t.popunder=t.popunder||document.getElementById("selectionSharerPopunder");var e=window.getSelection(),o=t.getSelectionText(e);if(e.isCollapsed||o.length<10||!o.match(/ /))return t.hidePopunder();if(t.popunder.classList.contains("fixed"))return t.popunder.style.bottom=0;var n=e.getRangeAt(0),r=n.endContainer.parentNode;if(t.popunder.classList.contains("show")){if(Math.ceil(t.popunder.getBoundingClientRect().top)==Math.ceil(r.getBoundingClientRect().bottom))return;return t.hidePopunder(t.showPopunder)}if(r.nextElementSibling)t.pushSiblings(r);else{t.placeholder||(t.placeholder=document.createElement("div"),t.placeholder.className="selectionSharerPlaceholder");var i=window.getComputedStyle(r).marginBottom;t.placeholder.style.height=i,t.placeholder.style.marginBottom=-2*parseInt(i,10)+"px",r.parentNode.insertBefore(t.placeholder)}var a=window.pageYOffset+r.getBoundingClientRect().bottom;t.popunder.style.top=Math.ceil(a)+"px",setTimeout(function(){t.placeholder&&t.placeholder.classList.add("show"),t.popunder.classList.add("show")},0)},this.pushSiblings=function(e){for(;e=e.nextElementSibling;)e.classList.add("selectionSharer"),e.classList.add("moveDown")},this.hidePopunder=function(e){if(e=e||function(){},"fixed"==t.popunder)return t.popunder.style.bottom="-50px",e();t.popunder.classList.remove("show"),t.placeholder&&t.placeholder.classList.remove("show");for(var o=document.getElementsByClassName("moveDown");el=o[0];)el.classList.remove("moveDown");setTimeout(function(){t.placeholder&&document.body.insertBefore(t.placeholder),e()},600)},this.show=function(e){setTimeout(function(){var o=window.getSelection(),n=t.getSelectionText(o);if(!o.isCollapsed&&n&&n.length>10&&n.match(/ /)){var r=o.getRangeAt(0),i=r.getBoundingClientRect().top-5,a=i+window.scrollY-t.$popover.height(),s=0;if(e)s=e.pageX;else{var l=o.anchorNode.parentNode;s+=l.offsetWidth/2;do s+=l.offsetLeft;while(l=l.offsetParent)}switch(t.selectionDirection(o)){case"forward":s-=t.$popover.width();break;case"backward":s+=t.$popover.width();break;default:return}t.$popover.removeClass("anim").css("top",a+10).css("left",s).show(),setTimeout(function(){t.$popover.addClass("anim").css("top",a)},0)}},10)},this.hide=function(e){t.$popover.hide()},this.smart_truncate=function(e,t){if(!e||!e.length)return e;var o=e.length>t,n=o?e.substr(0,t-1):e;return n=o?n.substr(0,n.lastIndexOf(" ")):n,o?n+"...":n},this.getRelatedTwitterAccounts=function(){var e=[],t=n('meta[name="twitter:creator"]').attr("content")||n('meta[name="twitter:creator"]').attr("value");t&&e.push(t);for(var o=document.getElementsByTagName("a"),r=0,i=o.length;i>r;r++)if(o[r].attributes.href&&"string"==typeof o[r].attributes.href.value){var a=o[r].attributes.href.value.match(/^https?:\/\/twitter\.com\/([a-z0-9_]{1,20})/i);a&&a.length>1&&-1==["widgets","intent"].indexOf(a[1])&&e.push(a[1])}return e.length>0?e.join(","):""},this.shareTwitter=function(e){e.preventDefault();var o="“"+t.smart_truncate(t.textSelection.trim(),114)+"”",n="http://twitter.com/intent/tweet?text="+encodeURIComponent(o)+"&related="+t.relatedTwitterAccounts+"&url="+encodeURIComponent(window.location.href);t.viaTwitterAccount&&o.length<114-t.viaTwitterAccount.length&&(n+="&via="+t.viaTwitterAccount);var r=640,i=440,a=screen.width/2-r/2,s=screen.height/2-i/2-100;return window.open(n,"share_twitter","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+r+", height="+i+", top="+s+", left="+a),t.hide(),!1},this.shareFacebook=function(e){e.preventDefault();var o=t.htmlSelection.replace(/<p[^>]*>/gi,"\n").replace(/<\/p>|  /gi,"").trim(),n="http://www.facebook.com/dialog/share?app_id="+t.appId+"&display=popup&name="+encodeURIComponent(o)+"&link="+encodeURIComponent(t.url2share)+"&href="+encodeURIComponent(t.url2share)+"&redirect_uri="+encodeURIComponent(t.url2share),r=640,i=440,a=screen.width/2-r/2,s=screen.height/2-i/2-100;window.open(n,"share_facebook","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+r+", height="+i+", top="+s+", left="+a)},this.shareEmail=function(e){var o=t.htmlSelection.replace(/<p[^>]*>/gi,"\n").replace(/<\/p>|  /gi,"").trim(),r={};return r.subject=encodeURIComponent("Quote from "+document.title),r.body=encodeURIComponent("“"+o+"”")+"%0D%0A%0D%0AFrom: "+document.title+"%0D%0A"+window.location.href,n(this).attr("href","mailto:?subject="+r.subject+"&body="+r.body),t.hide(),!0},this.render=function(){t.$popover=n(l["default"]),t.$popover.find("a.tweet").click(t.shareTwitter),t.$popover.find("a.facebook").click(t.shareFacebook),t.$popover.find("a.email").click(t.shareEmail),n("body").append(t.$popover),t.$popunder=n(p["default"]),t.$popunder.find("a.tweet").click(t.shareTwitter),t.$popunder.find("a.facebook").click(t.shareFacebook),t.$popunder.find("a.email").click(t.shareEmail),n("body").append(t.$popunder),t.appId&&t.url2share&&n(".selectionSharer a.facebook").css("display","inline-block")},this.setElements=function(e){"string"==typeof e&&(e=n(e)),t.$elements=e instanceof n?e:n(e),t.$elements.mouseup(t.show).mousedown(t.hide).addClass("selectionShareable"),t.$elements.bind("touchstart",function(e){t.isMobile=!0}),document.onselectionchange=t.selectionChanged},this.selectionChanged=function(e){t.isMobile&&(t.lastSelectionChanged&&clearTimeout(t.lastSelectionChanged),t.lastSelectionChanged=setTimeout(function(){t.showPopunder(e)},300))},this.render(),e.elements&&this.setElements(e.elements)};n.fn.selectionSharer=function(){var e=new i;return e.setElements(this),this},r=function(){return i.load=function(e,t,o,n){var r=new i;r.setElements("p"),o()},i}.call(t,o,t,e),!(void 0!==r&&(e.exports=r))}(jQuery)},/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./~/css-loader!./~/autoprefixer-loader?browsers=last 2 version!./~/sass-loader?outputStyle=expanded&includePaths[]=/Users/romain/selection-sharer/node_modules&includePaths[]=/Users/romain/selection-sharer/bower_components&includePaths[]=/Users/romain/selection-sharer/src/vendor!./src/selection-sharer.css ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************/
function(e,t,o){t=e.exports=o(/*! ./../~/css-loader/lib/css-base.js */2)(),t.push([e.id,'@-webkit-keyframes selectionSharerPopover-animation{0%{-webkit-transform:matrix(.97,0,0,1,0,12);transform:matrix(.97,0,0,1,0,12);filter:alpha(opacity=0);opacity:0}20%{-webkit-transform:matrix(.99,0,0,1,0,2);transform:matrix(.99,0,0,1,0,2);filter:alpha(opacity=70);opacity:.7}40%{-webkit-transform:matrix(1,0,0,1,0,-1);transform:matrix(1,0,0,1,0,-1);filter:alpha(opacity=100);opacity:1}100%,70%{-webkit-transform:matrix(1,0,0,1,0,0);transform:matrix(1,0,0,1,0,0);filter:alpha(opacity=100);opacity:1}}@keyframes selectionSharerPopover-animation{0%{-webkit-transform:matrix(.97,0,0,1,0,12);transform:matrix(.97,0,0,1,0,12);filter:alpha(opacity=0);opacity:0}20%{-webkit-transform:matrix(.99,0,0,1,0,2);transform:matrix(.99,0,0,1,0,2);filter:alpha(opacity=70);opacity:.7}40%{-webkit-transform:matrix(1,0,0,1,0,-1);transform:matrix(1,0,0,1,0,-1);filter:alpha(opacity=100);opacity:1}100%,70%{-webkit-transform:matrix(1,0,0,1,0,0);transform:matrix(1,0,0,1,0,0);filter:alpha(opacity=100);opacity:1}}#selectionSharerPopover{display:none;position:absolute;top:-100px;left:-100px;z-index:1010}#selectionSharerPopover:after{content:\'\';display:block;position:absolute;bottom:-3px;left:50%;margin-left:-4px;width:8px;height:8px;-webkit-transform:rotate(45deg);transform:rotate(45deg);background:#262625;box-shadow:0 0 2px #262625}#selectionSharerPopover.anim{transition:top .075s ease-out;animation:selectionSharerPopover-animation 180ms forwards linear;-webkit-animation:selectionSharerPopover-animation 180ms forwards linear}#selectionSharerPopover-inner{position:relative;overflow:hidden;border-radius:5px;border:1px solid;border-color:#262625 #1c1c1b #121211;box-shadow:0 1px 3px -1px rgba(0,0,0,.7),inset 0 0 1px rgba(255,255,255,.07),inset 0 0 2px rgba(255,255,255,.15);background-image:linear-gradient(to bottom,rgba(49,49,47,.97),#262625);background-repeat:repeat-x}#selectionSharerPopover .selectionSharerPopover-clip{position:absolute;bottom:-11px;display:block;left:50%;clip:rect(12px 24px 24px 0);margin-left:-12px;width:24px;height:24px;line-height:24px}#selectionSharerPopover .selectionSharerPopover-arrow{display:block;width:20px;height:20px;-webkit-transform:rotate(45deg) scale(.5);transform:rotate(45deg) scale(.5);background-color:#454543;border:2px solid #121211;box-sizing:content-box}.selectionSharer ul{padding:0;display:inline}.selectionSharer ul li{float:left;list-style:none;background:0 0;margin:0}.selectionSharer a.action{display:block;text-indent:-200px;margin:5px 7px;width:20px;height:20px;border:none}.selectionSharer a:hover{color:#ccc}.selectionSharer a.tweet{background:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="171" height="139"><g transform="translate(-282.32053,-396.30734)"><path style="fill:white" d="m 453.82593,412.80619 c -6.3097,2.79897 -13.09189,4.68982 -20.20852,5.54049 7.26413,-4.35454 12.84406,-11.24992 15.47067,-19.46675 -6.79934,4.03295 -14.3293,6.96055 -22.34461,8.53841 -6.41775,-6.83879 -15.56243,-11.111 -25.68298,-11.111 -19.43159,0 -35.18696,15.75365 -35.18696,35.18525 0,2.75781 0.31128,5.44359 0.91155,8.01875 -29.24344,-1.46723 -55.16995,-15.47582 -72.52461,-36.76396 -3.02879,5.19662 -4.76443,11.24048 -4.76443,17.6891 0,12.20777 6.21194,22.97747 15.65332,29.28716 -5.76773,-0.18265 -11.19331,-1.76565 -15.93716,-4.40083 -0.004,0.14663 -0.004,0.29412 -0.004,0.44248 0,17.04767 12.12889,31.26806 28.22555,34.50266 -2.95247,0.80436 -6.06101,1.23398 -9.26989,1.23398 -2.2673,0 -4.47114,-0.22124 -6.62011,-0.63114 4.47801,13.97857 17.47214,24.15143 32.86992,24.43441 -12.04227,9.43796 -27.21366,15.06335 -43.69965,15.06335 -2.84014,0 -5.64082,-0.16722 -8.39349,-0.49223 15.57186,9.98421 34.06703,15.8094 53.93768,15.8094 64.72024,0 100.11301,-53.61524 100.11301,-100.11387 0,-1.52554 -0.0343,-3.04251 -0.10204,-4.55261 6.87394,-4.95995 12.83891,-11.15646 17.55618,-18.21305 z" /></g></svg>\') 2px 4px no-repeat;background-size:18px}.selectionSharer a.facebook{background:url(\'data:image/svg+xml;utf8,<svg viewBox="0 0 33 33" width="25" height="25" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path style="fill:white" d="M 17.996,32L 12,32 L 12,16 l-4,0 l0-5.514 l 4-0.002l-0.006-3.248C 11.993,2.737, 13.213,0, 18.512,0l 4.412,0 l0,5.515 l-2.757,0 c-2.063,0-2.163,0.77-2.163,2.209l-0.008,2.76l 4.959,0 l-0.585,5.514L 18,16L 17.996,32z"></path></g></svg>\') 0 2px no-repeat;background-size:18px;display:none}.selectionSharer a.email{background:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="94" height="64"><g transform="translate(-10, -10)" fill="transparent"><rect x="0" y="0" width="114" height="114"></rect><path d="M12,12 L102,12 L102,72 L12,72 L12,12 Z M16,12 L53,49 C55.6666667,51 58.3333333,51 61,49 L98,12 L16,12 Z M15,72 L45,42 L15,72 Z M69,42 L99,72 L69,42 Z" stroke="white" stroke-width="5"></path></g></svg>\') 0 4px no-repeat;background-size:20px}#selectionSharerPopunder.fixed{transition:bottom .5s ease-in-out;width:100%;position:fixed;left:0;bottom:-50px}.selectionSharer{transition:-webkit-transform .6s ease-in-out}.selectionSharer.moveDown{-webkit-transform:translate3d(0,60px,0)}#selectionSharerPopunder{position:absolute;left:0;width:100%;height:0;transition:height .5s ease-in-out;background:#ccc;border:none;box-shadow:inset 0 10px 5px -10px rgba(0,0,0,.5),inset 0 -10px 5px -10px rgba(0,0,0,.5);border-radius:0;overflow:hidden}#selectionSharerPopunder.show{height:50px}.selectionSharerPlaceholder{height:1em;margin-bottom:-2em;transition:height .5s ease-in-out}.selectionSharerPlaceholder.show{height:50px!important}#selectionSharerPopunder-inner ul{overflow:hidden;float:right;margin:0}#selectionSharerPopunder-inner ul li{padding:5px;overflow:hidden}#selectionSharerPopunder-inner label{color:#fff;font-weight:300;line-height:50px;margin:0 20px 0 10px}#selectionSharerPopunder-inner a{width:30px;height:30px;background-size:30px}#selectionSharerPopunder-inner a.tweet{background-position:0 2px}',""])},/*!**************************************!*\
  !*** ./~/css-loader/lib/css-base.js ***!
  \**************************************/
function(e,t,o){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var o=this[t];o[2]?e.push("@media "+o[2]+"{"+o[1]+"}"):e.push(o[1])}return e.join("")},e.i=function(t,o){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},r=0;r<this.length;r++){var i=this[r][0];"number"==typeof i&&(n[i]=!0)}for(r=0;r<t.length;r++){var a=t[r];"number"==typeof a[0]&&n[a[0]]||(o&&!a[2]?a[2]=o:o&&(a[2]="("+a[2]+") and ("+o+")"),e.push(a))}},e}},/*!*****************************************!*\
  !*** ./~/raw-loader!./src/popover.html ***!
  \*****************************************/
function(e,t,o){e.exports='<div className="selectionSharer" id="selectionSharerPopover" style="position:absolute;">\n  <div id="selectionSharerPopover-inner">\n    <ul>\n      <li><a className="action tweet" href="" title="Share this selection on Twitter" target="_blank">Tweet</a></li>\n      <li><a className="action facebook" href="" title="Share this selection on Facebook" target="_blank">Facebook</a></li>\n      <li><a className="action email" href="" title="Share this selection by email" target="_blank"><svg width="20" height="20"><path stroke="#FFF" stroke-width="6" d="m16,25h82v60H16zl37,37q4,3 8,0l37-37M16,85l30-30m22,0 30,30"/></svg></a></li>\n    </ul>\n  </div>\n  <div className="selectionSharerPopover-clip"><span className="selectionSharerPopover-arrow"></span></div>\n</div>\n'},/*!******************************************!*\
  !*** ./~/raw-loader!./src/popunder.html ***!
  \******************************************/
function(e,t,o){e.exports='<div id="selectionSharerPopunder" className="selectionSharer">\n  <div id="selectionSharerPopunder-inner">\n    <label>Share this selection</label>\n    <ul>\n      <li><a className="action tweet" href="" title="Share this selection on Twitter" target="_blank">Tweet</a></li>\n      <li><a className="action facebook" href="" title="Share this selection on Facebook" target="_blank">Facebook</a></li>\n      <li><a className="action email" href="" title="Share this selection by email" target="_blank"><svg width="20" height="20"><path stroke="#FFF" stroke-width="6" d="m16,25h82v60H16zl37,37q4,3 8,0l37-37M16,85l30-30m22,0 30,30"/></svg></a></li>\n    </ul>\n  </div>\n</div>\n'},/*!*************************************!*\
  !*** ./~/style-loader/addStyles.js ***!
  \*************************************/
function(e,t,o){function n(e,t){for(var o=0;o<e.length;o++){var n=e[o],r=h[n.id];if(r){r.refs++;for(var i=0;i<r.parts.length;i++)r.parts[i](n.parts[i]);for(;i<n.parts.length;i++)r.parts.push(s(n.parts[i],t))}else{for(var a=[],i=0;i<n.parts.length;i++)a.push(s(n.parts[i],t));h[n.id]={id:n.id,refs:1,parts:a}}}}function r(e){for(var t=[],o={},n=0;n<e.length;n++){var r=e[n],i=r[0],a=r[1],s=r[2],l=r[3],c={css:a,media:s,sourceMap:l};o[i]?o[i].parts.push(c):t.push(o[i]={id:i,parts:[c]})}return t}function i(e){var t=document.createElement("style"),o=f(e);return t.type="text/css",o.appendChild(t),t}function a(){var e=document.createElement("link"),t=getHeadElement();return e.rel="stylesheet",t.appendChild(e),e}function s(e,t){var o,n,r;if(t.singleton){var s=g++;o=m||(m=i(t.element)),n=l.bind(null,o,s,!1),r=l.bind(null,o,s,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(o=a(),n=p.bind(null,o),r=function(){o.parentNode.removeChild(o),o.href&&URL.revokeObjectURL(o.href)}):(o=i(t.element),n=c.bind(null,o),r=function(){o.parentNode.removeChild(o)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else r()}}function l(e,t,o,n){var r=o?"":n.css;if(e.styleSheet)e.styleSheet.cssText=v(t,r);else{var i=document.createTextNode(r),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}function c(e,t){var o=t.css,n=t.media;t.sourceMap;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}function p(e,t){var o=t.css,n=(t.media,t.sourceMap);n&&(o+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var r=new Blob([o],{type:"text/css"}),i=e.href;e.href=URL.createObjectURL(r),i&&URL.revokeObjectURL(i)}var h={},d=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},u=d(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),f=function(e){return e||document.head||document.getElementsByTagName("head")[0]},m=null,g=0;e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=u());var o=r(e);return n(o,t),function(e){for(var i=[],a=0;a<o.length;a++){var s=o[a],l=h[s.id];l.refs--,i.push(l)}if(e){var c=r(e);n(c,t)}for(var a=0;a<i.length;a++){var l=i[a];if(0===l.refs){for(var p=0;p<l.parts.length;p++)l.parts[p]();delete h[l.id]}}}};var v=function(){var e=[];return function(t,o){return e[t]=o,e.filter(Boolean).join("\n")}}()},/*!**********************************!*\
  !*** ./src/selection-sharer.css ***!
  \**********************************/
function(e,t,o){var n,r=0,i=o(/*! !./../~/css-loader!./../~/autoprefixer-loader?browsers=last 2 version!./../~/sass-loader?outputStyle=expanded&includePaths[]=/Users/romain/selection-sharer/node_modules&includePaths[]=/Users/romain/selection-sharer/bower_components&includePaths[]=/Users/romain/selection-sharer/src/vendor!./selection-sharer.css */1);"string"==typeof i&&(i=[[e.id,i,""]]),t.use=t.ref=function(e){/*! ./../~/style-loader/addStyles.js */
return r++||(t.locals=i.locals,n=o(5)(i,{element:e})),t},t.unuse=t.unref=function(){--r||(n(),n=null)}}])});